<?xml version="1.0" encoding="UTF-8"?>

<apiroConf version="1" xmlns="http://apiro.com/apiro/v1/root">
    <groups/>
    <loadOrder>15</loadOrder>
    <schemas>
        <schema defBacked="false" historical="false" name="CUSTOMER">
            <groupTags>
                <groupTag>EXAMPLES</groupTag>
            </groupTags>
            <metaData/>
            <identityKeys>
                <identityKey>BAC</identityKey>
            </identityKeys>

            <!-- Data Point descriptions -->
            <dataPoints>
                <dataPoint name="BAC"
                           dataType="STRING"
                           canEditValid="true"
                           canEditViolated="true"
                           displayName="BAC">
                    <nullable>false</nullable>

                    <metaData>
                        <item name="piiClassification">
                            <simpleValues>
                                <simpleValue>High Risk</simpleValue>
                            </simpleValues>
                        </item>
                    </metaData>

                    <!-- BAC data point processors -->
                    <rawDPValidators/>
                    <rawDPProcessors/>
                    <!--consolidationAlgorithm></consolidationAlgorithm -->
                    <consDPValidators/>
                    <consDPProcessors/>
                </dataPoint>

                <dataPoint name="FIRST_NAME"
                           dataType="STRING"
                           displayName="First Name"
                           canEditValid="true"
                           canEditViolated="true">
                    <rawDPValidators>
                        <rawDPValidator name="IN_BAC_SET_CHECK " entity="IN_SET">
                            <config>
                                <![CDATA[
                            {
                                ignoreCase : true,
                                options : [ "Tom", "Bob"]
                            }
                        ]]>
                            </config>
                        </rawDPValidator>
                    </rawDPValidators>
                </dataPoint>

                <dataPoint name="LAST_NAME" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="LAST NAME">
                    <rawDPProcessors>
                        <rawDPProcessor name="CAPITALISE_LAST_NAME_RAW_PROC" entity="GEN_EXPRESS">
                            <config>
                                <![CDATA[
                                    #GRV{
                                        CTX['.'] = CTX['.'].toUpperCase()
                                    }
                                ]]>
                            </config>

                        </rawDPProcessor>
                    </rawDPProcessors>
                </dataPoint>

                <dataPoint name="ADDRESS" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="ADDRESS"/>
                <dataPoint name="PHONE_NUMBER" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="PHONE NUMBER"/>
                <dataPoint  name="AGE" dataType="INTEGER" canEditValid="true" canEditViolated="true" displayName="Age">
                    <rawDPValidators>
                        <rawDPValidator name="INVALID_IF_NULL" entity="NOT_NULL"/> // The name can be anything and it will appear in data audit/lineage
                        <rawDPValidator name="INVALID_IF_NEGATIVE" entity="POSITIVE">
                            <lateBound>false</lateBound> // This is the default value if one is not specified
                        </rawDPValidator>
                    </rawDPValidators>
                </dataPoint>
                <dataPoint name="YEARLY_INCOME" canEditValid="false" canEditViolated="true" dataType="DECIMAL" displayName="YEARLY INCOME"/>
                <dataPoint name="TFN" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="TFN"/>

                <dataPoint name="PORTFOLIO_VALUE"
                           displayName="Investment Portfolio Value"
                           dataType="DECIMAL"
                           canEditValid="false"
                           canEditViolated="true" >

                        <consolidationAlgorithm name="PORTF_VALUE_WEIGHTED_MEAN_01" entity="GEN_EXPRESS">
                            <config>
                                <![CDATA[
                                    #GRV{
                                        def list= []

                                        list.add(items.get("CUSTOMER_GIT_XLSX_A"))
                                        list.add(items.get("CUSTOMER_GIT_XLSX_B"))
                                        list.remove(null)

                                        if(list.size()==0)
                                            return 0;
                                        else if (list.size() == 1)
                                            return list[0]
                                        else {
                                            return (list[0].asDBL()*0.8 + list[1].asDBL()*0.2)
                                        }
                                    }
                                    ]]>
                            </config>
                        </consolidationAlgorithm>
                </dataPoint>

                <dataPoint name="COMPANY_NAME" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="COMPANY NAME"/>
                <dataPoint name="COMPANY_ADDRESS" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="COMPANY ADDRESS"/>
                <dataPoint name="PROFILE_IMAGE" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="PROFILE_IMAGE"/>
                <dataPoint name="COMPANY_WEBSITE" canEditValid="false" canEditViolated="true" dataType="STRING" displayName="COMPANY WEBSITE"/>
                <dataPoint name="XML_ROOT_DOC"  canEditValid="false" canEditViolated="true"  displayName="XML Root Doc" dataType="XML"/>
                <dataPoint name="JSON_ROOT_DOC"  canEditValid="false" canEditViolated="true"  displayName="JSON Root Doc" dataType="JSON"/>
            </dataPoints>
            <schemaAppliedProcessors>
                <groupTags>
                    <groupTag>DEFAULT</groupTag>
                </groupTags>
                <metaData/>
                <rawDPValidators/>
                <rawDPProcessors/>
                <consDPValidators/>
                <consDPProcessors/>
                <dataBlockProcessors/>
            </schemaAppliedProcessors>
            <alerts/>
        </schema>
    </schemas>
</apiroConf>